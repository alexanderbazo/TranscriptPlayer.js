!function(t){"use strict";function e(t,e){var i=document.createDocumentFragment(),n=document.createElement("div"),s=document.createElement("audio"),a=document.createElement("div"),r=document.createElement("span"),l=document.createElement("span"),o=document.createElement("input");return n.classList.add("transcript-player-viewer"),a.classList.add("transcript-player-controls"),s.classList.add("transcript-player-player"),r.classList.add("transcript-player-control","button","play-button","paused"),l.classList.add("transcript-player-control","button","sound-button","unmuted"),o.classList.add("transcript-player-control","seekbar"),o.setAttribute("type","range"),o.setAttribute("min","0"),o.setAttribute("max","100"),o.value=0,r.addEventListener("click",t.onPlayButtonClicked.bind(t)),l.addEventListener("click",t.onSoundButtonClicked.bind(t)),o.addEventListener("input",t.onSeekbarChanged.bind(t)),a.appendChild(r),a.appendChild(l),a.appendChild(o),i.appendChild(n),i.appendChild(a),i.appendChild(s),e.appendChild(i),e.viewer=e.querySelector(".transcript-player-viewer"),e.player=e.querySelector(".transcript-player-player"),e.seekbar=e.querySelector(".transcript-player-control.seekbar"),e.classList.add("transcript-player-host"),e}function i(t){if(void 0===t)throw"No parent element specified";this.playerElement=e(this,t),this.audioPlayer=this.playerElement.player,this.segmentTemplate=n,this.listeners=[],this.tick=250}var n="<span class='transcript-player-segment'><span class='handle'></span><span class='time'><span class='start'>{{start}}ms</span><br />-<br /> <span class='end'>{{end}}ms</span></span><span class='text'>{{text}}</span></span>";i.prototype.notifyAll=function(t,e){var i,n=e||null;if(this.listeners[t])for(i=0;i<this.listeners[t].length;i++)this.listeners[t][i](n)},i.prototype.addEventListener=function(t,e){if(void 0===t||void 0===e)throw"Must specified event and listener";this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e)},i.prototype.onPlaybackTick=function(){this.updateSeekbar(1e3*this.audioPlayer.currentTime),this.selectCurrentSegment(1e3*this.audioPlayer.currentTime)},i.prototype.startPlaybackTick=function(){this.playbackTick||(this.playbackTick=setInterval(this.onPlaybackTick.bind(this),this.tick))},i.prototype.stopPlaybackTick=function(){clearInterval(this.playbackTick),this.playbackTick=void 0},i.prototype.onAudioFileLoaded=function(){this.playerElement.seekbar.setAttribute("max",1e3*this.audioPlayer.duration)},i.prototype.onPlayButtonClicked=function(t){var e="pause";t.target.classList.toggle("playing"),t.target.classList.toggle("paused"),t.target.classList.contains("playing")?(e="play",this.play()):this.pause(),this.notifyAll(e)},i.prototype.onSoundButtonClicked=function(t){var e="mute";t.target.classList.toggle("unmuted"),t.target.classList.toggle("muted"),t.target.classList.contains("unmuted")&&(e="unmute"),this.notifyAll(e)},i.prototype.onHandleClicked=function(t){return t},i.prototype.onSeekbarChanged=function(t){this.setPlaybackPosition(t.target.value),this.selectCurrentSegment(t.target.value)},i.prototype.play=function(){this.audioPlayer.play(),this.startPlaybackTick()},i.prototype.pause=function(){this.audioPlayer.pause(),this.stopPlaybackTick()},i.prototype.stop=function(){this.audioPlayer.pause(),this.setAudioPosition(0),this.stopPlaybackTick()},i.prototype.setAudioPosition=function(t){this.audioPlayer.currentTime=t/1e3,this.updateSeekbar(t),this.selectCurrentSegment(t)},i.prototype.setPlaybackPosition=function(t){var e=this.audioPlayer.paused;e||this.audioPlayer.pause(),this.audioPlayer.currentTime=t/1e3,e||this.audioPlayer.play()},i.prototype.updateSeekbar=function(t){this.playerElement.seekbar.value=t},i.prototype.selectCurrentSegment=function(t){var e=this.findCurrentSegment(t);void 0!==e&&this.currentSegmentID!==e.id&&(this.currentSegmentID=e.id,this.clearSegmentHighlights(),this.hightlightSegment(e.id))},i.prototype.findCurrentSegment=function(t){var e,i;for(e=0;e<this.segments.length;e++)if(i=this.segments[e],i.start<t&&i.end>=t)return i},i.prototype.clearSegmentHighlights=function(){var t,e=this.playerElement.viewer.querySelectorAll(".transcript-player-segment");for(this.currentSegmentID=void 0,t=0;t<e.length;t++)e[t].classList.remove("highlighted")},i.prototype.hightlightSegment=function(t){this.currentSegmentID=t,this.playerElement.viewer.querySelector("#segment-"+t).classList.add("highlighted")},i.prototype.renderSegments=function(){var t,e,i,n,s,a=this.playerElement.viewer;for(t=0;t<this.segments.length;t++){i=this.segments[t],s=this.segmentTemplate,e=document.createElement("span");for(n in i)i.hasOwnProperty(n)&&(s=s.replace("{{"+n+"}}",i[n]));e.innerHTML=s,e.querySelector(".handle").addEventListener("click",this.onHandleClicked.bind(this)),e.children[0].id="segment-"+i.id,a.appendChild(e.children[0])}},i.prototype.setFile=function(t){this.audioPlayer.src=t,this.audioPlayer.addEventListener("loadeddata",this.onAudioFileLoaded.bind(this))},i.prototype.setSegmentTemplate=function(t){this.segmentTemplate=t},i.prototype.loadTranscript=function(t,e){this.audio=t,this.segments=e,this.setFile(t),this.renderSegments()},t.TranscriptPlayer=i}(window);